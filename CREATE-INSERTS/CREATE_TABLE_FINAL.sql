-- Tabela Tipo de Sensor
CREATE TABLE GS_WW_TIPO_SENSOR (
    ID_TIPO_SENSOR NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NOME_TIPO VARCHAR2(50) NOT NULL UNIQUE,
    DESCRICAO VARCHAR2(200),
    UNIDADE_MEDIDA VARCHAR2(20),
    VALOR_MIN NUMBER(10,2),
    VALOR_MAX NUMBER(10,2)
);

-- Tabela NÃ­vel de Severidade
CREATE TABLE GS_WW_NIVEL_SEVERIDADE (
    ID_NIVEL_SEVERIDADE NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CODIGO_SEVERIDADE VARCHAR2(20) NOT NULL UNIQUE,
    DESCRICAO_SEVERIDADE VARCHAR2(100) NOT NULL,
    ACOES_RECOMENDADAS VARCHAR2(500)
);

-- Tabela Nivel de Degradacao do Solo
CREATE TABLE GS_WW_NIVEL_DEGRADACAO_SOLO (
    ID_NIVEL_DEGRADACAO NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CODIGO_DEGRADACAO VARCHAR2(20) NOT NULL UNIQUE,
    DESCRICAO_DEGRADACAO VARCHAR2(150) NOT NULL,
    NIVEL_NUMERICO NUMBER(1) NOT NULL CHECK (NIVEL_NUMERICO BETWEEN 1 AND 5),
    ACOES_CORRETIVAS VARCHAR2(500)
);

-- ============================================================================
-- 2. TABELAS PRINCIPAIS (COM RELACIONAMENTOS)
-- ============================================================================

-- Tabela Produtor Rural
CREATE TABLE GS_WW_PRODUTOR_RURAL (
    ID_PRODUTOR NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NOME_COMPLETO VARCHAR2(100) NOT NULL,
    CPF_CNPJ VARCHAR2(18) NOT NULL UNIQUE,
    EMAIL VARCHAR2(100) NOT NULL UNIQUE,
    TELEFONE VARCHAR2(15),
    DATA_CADASTRO DATE DEFAULT SYSDATE
);

-- Tabela Propriedade Rural
CREATE TABLE GS_WW_PROPRIEDADE_RURAL (
    ID_PROPRIEDADE NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ID_PRODUTOR NUMBER NOT NULL,
    ID_NIVEL_DEGRADACAO NUMBER NOT NULL,
    NOME_PROPRIEDADE VARCHAR2(100) NOT NULL,
    LATITUDE NUMBER(10,7) NOT NULL,
    LONGITUDE NUMBER(10,7) NOT NULL,
    AREA_HECTARES NUMBER(10,2) NOT NULL,
    DATA_CADASTRO DATE DEFAULT SYSDATE,
    -- Constraints de relacionamento
    CONSTRAINT FK_PROP_PRODUTOR FOREIGN KEY (ID_PRODUTOR) 
        REFERENCES GS_WW_PRODUTOR_RURAL(ID_PRODUTOR),
    CONSTRAINT FK_PROP_DEGRADACAO FOREIGN KEY (ID_NIVEL_DEGRADACAO) 
        REFERENCES GS_WW_NIVEL_DEGRADACAO_SOLO(ID_NIVEL_DEGRADACAO)
);

-- Tabela Sensor IoT
CREATE TABLE GS_WW_SENSOR_IOT (
    ID_SENSOR NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ID_PROPRIEDADE NUMBER NOT NULL,
    ID_TIPO_SENSOR NUMBER NOT NULL,
    MODELO_DISPOSITIVO VARCHAR2(50),
    DATA_INSTALACAO DATE DEFAULT SYSDATE,
    -- Constraints de relacionamento
    CONSTRAINT FK_SENSOR_PROPRIEDADE FOREIGN KEY (ID_PROPRIEDADE) 
        REFERENCES GS_WW_PROPRIEDADE_RURAL(ID_PROPRIEDADE),
    CONSTRAINT FK_SENSOR_TIPO FOREIGN KEY (ID_TIPO_SENSOR) 
        REFERENCES GS_WW_TIPO_SENSOR(ID_TIPO_SENSOR)
);

-- Tabela Leitura Sensor
CREATE TABLE GS_WW_LEITURA_SENSOR (
    ID_LEITURA NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ID_SENSOR NUMBER NOT NULL,
    TIMESTAMP_LEITURA TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UMIDADE_SOLO NUMBER(5,2) CHECK (UMIDADE_SOLO BETWEEN 0 AND 100),
    TEMPERATURA_AR NUMBER(4,1) CHECK (TEMPERATURA_AR BETWEEN -20 AND 60),
    PRECIPITACAO_MM NUMBER(6,2) CHECK (PRECIPITACAO_MM >= 0),
    -- Constraint de relacionamento
    CONSTRAINT FK_LEITURA_SENSOR FOREIGN KEY (ID_SENSOR) 
        REFERENCES GS_WW_SENSOR_IOT(ID_SENSOR)
);

-- Tabela Alerta
CREATE TABLE GS_WW_ALERTA (
    ID_ALERTA NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ID_PRODUTOR NUMBER NOT NULL,
    ID_LEITURA NUMBER NOT NULL,
    ID_NIVEL_SEVERIDADE NUMBER NOT NULL,
    TIMESTAMP_ALERTA TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    DESCRICAO_ALERTA VARCHAR2(500),
    -- Constraints de relacionamento
    CONSTRAINT FK_ALERTA_PRODUTOR FOREIGN KEY (ID_PRODUTOR) 
        REFERENCES GS_WW_PRODUTOR_RURAL(ID_PRODUTOR),
    CONSTRAINT FK_ALERTA_LEITURA FOREIGN KEY (ID_LEITURA) 
        REFERENCES GS_WW_LEITURA_SENSOR(ID_LEITURA),
    CONSTRAINT FK_ALERTA_SEVERIDADE FOREIGN KEY (ID_NIVEL_SEVERIDADE) 
        REFERENCES GS_WW_NIVEL_SEVERIDADE(ID_NIVEL_SEVERIDADE)
);
